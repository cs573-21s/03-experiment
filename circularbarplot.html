<!doctype html>
<html lang="en">
<head>
  <title>CS573 a1</title>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/LIB/d3-scale-radial.js"></script>
  <style>
    body {
      margin: 0px; 
      width: 100vw; 
      height: 100vh;
    }

    .svg-container {
      display: inline-block;
      position: relative;
      width: 100vw;
      height: 100vh;
      vertical-align: top;
      overflow: hidden;
    }

    .svg-content {
      display: inline-block;
      position: absolute;
      top: 0;
      left: 0;
    }

    div.tooltip-point {
        position: absolute;
        text-align: left;
        padding: .5rem;
        background: #FFFFFF;
        color: #000000;
        border: 1px solid #000000;
        border-radius: 8px;
        pointer-events: none;
        font-family: sans-serif;
        font-size: 1rem;
    }

    text {
        font-family: sans-serif;
        font-weight: bold;
    }

  </style>
</head>
<body>
    <div id="container" class="svg-container">
    </div>

    <script>
        console.log(d3);

        var margin = { top: 450, right: 0, bottom: 0, left: 350 },
            width = 1000 - margin.left - margin.right,
            height = 1000 - margin.top - margin.bottom,
            innerRadius = 100,
            outerRadius = Math.min(width, height) / 2;

        var svg = d3.select('div#container').append('svg')
            .attr('viewBox', '0 0 1920 1080')
            .attr('preserveAspectRatio', 'xMinYMin meet')
            .classed('svg-content', true)

        function generateDataset() {
            //choose size of data set between 5-10
            let datasetCount = Math.floor(Math.random() * 6) + 5; 

            //choose two random data points
            let chosenPoint1 = Math.floor(Math.random() * datasetCount);
            let chosenPoint2 = Math.floor(Math.random() * datasetCount);
            while (chosenPoint1 == chosenPoint2) { //make sure we did not choose same one twice
                chosenPoint2 = Math.floor(Math.random() * datasetCount);
            }
        
            //create dataset
            let myDataset = Array.from({length: datasetCount}, () => Math.floor(Math.random() * 101));

            //create struct
            var data = {
                mark1: chosenPoint1,
                mark2: chosenPoint2,
                dataset: myDataset
            };

            return data;
        }     

        function generateCircularBarplot(data) {

            console.log(data)

            // Scales
            var x = d3.scaleBand()
                .range([0, 2 * Math.PI])    // X axis goes from 0 to 2pi = all around the circle. If I stop at 1Pi, it will be around a half circle
                .domain(data.map(function(d) { return d.letter; })); // The domain of the X axis is the list of states.
            var y = d3.scaleRadial()
                .range([innerRadius, outerRadius])   // Domain will be define later.
                .domain([0, 100]); // Domain of Y is from 0 to the max seen in the data

            // Add the bars
            svg.append("g")
            .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')
            .selectAll("path")
            .data(data)
            .enter()
            .append("path")
                .attr("fill", "#69b3a2")
                .attr("d", d3.arc()     // imagine your doing a part of a donut plot
                    .innerRadius(innerRadius)
                    .outerRadius(function(d) { 
                        console.log(d);
                        return y(d['frequency']); })
                    .startAngle(function(d) { return x(d.letter); })
                    .endAngle(function(d) { return x(d.letter) + x.bandwidth(); })
                    .padAngle(0.01)
                    .padRadius(innerRadius))

            // Add the labels
            svg.append("g")
                .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')
                .selectAll("g")
                .data(data)
                .enter()
                .append("g")
                .attr("text-anchor", function(d) { return (x(d.letter) + x.bandwidth() / 2 + Math.PI) % (2 * Math.PI) < Math.PI ? "end" : "start"; })
                .attr("transform", function(d) { return "rotate(" + ((x(d.letter) + x.bandwidth() / 2) * 180 / Math.PI - 90) + ")"+"translate(" + (y(d['frequency'])+10) + ",0)"; })
                .append("text")
                .text(function(d){return(d.letter)})
                .attr("transform", function(d) { return (x(d.letter) + x.bandwidth() / 2 + Math.PI) % (2 * Math.PI) < Math.PI ? "rotate(180)" : "rotate(0)"; })
                .style("font-size", "11px")
                .attr("alignment-baseline", "middle")
        }

        let data1 = generateDataset();
        console.log("mark1: " + data1.mark1 + " mark2: " + data1.mark2 + " dataset: " + data1.dataset);

        var data = [
            {letter: "A", frequency: 5},
            {letter: "B", frequency: 4},
            {letter: "C", frequency: 4},
            {letter: "D", frequency: 3},
            {letter: "E", frequency: 6},
            {letter: "F", frequency: 8},
            {letter: "G", frequency: 9},
            {letter: "H", frequency: 10},
            {letter: "I", frequency: 6},
            {letter: "J", frequency: 8},
            {letter: "K", frequency: 3},
            {letter: "L", frequency: 5},
            {letter: "M", frequency: 6},
            {letter: "N", frequency: 7},
            {letter: "O", frequency: 3},
            {letter: "P", frequency: 2},
            {letter: "Q", frequency: 5},
            {letter: "R", frequency: 4},
            {letter: "S", frequency: 6},
            {letter: "T", frequency: 8},
            {letter: "U", frequency: 9},
            {letter: "V", frequency: 11},
            {letter: "W", frequency: 23},
            {letter: "X", frequency: 23},
            {letter: "Y", frequency: 34},
            {letter: "Z", frequency: 13}
        ];

        generateCircularBarplot(data);

    </script>
</body>
</html>